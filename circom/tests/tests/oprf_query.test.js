const { wasm } = require("circom_tester");
const { expect } = require("chai");
const path = require("path");

describe("Oprf Query (d=30)", function () {
    this.timeout(10000);

    let circuit;
    before(async () => {
        circuit = await wasm(
            path.join(__dirname, "circuits/oprf_query_test.circom"),
            { include: [path.join(__dirname, "../../")] },
        );
        await circuit.loadConstraints();
    });

    it("kat0 success", async () => {
        const witness = await circuit.calculateWitness(
            {
                pk: [
                    [
                        19565493445664319509682066258510677837096271188915949860977009706932369175203n,
                        19978457304613810993398911764266975074926641065301749225468860215203965473373n,
                    ],
                    [0n, 1n],
                    [0n, 1n],
                    [0n, 1n],
                    [0n, 1n],
                    [0n, 1n],
                    [0n, 1n],
                ],
                pk_index: 0n,
                s: 554036835054014596689133129775275210429926310845300985076950776856375504079n,
                r: [
                    2935169873833602205329832148018463160341406366090112498723276323952556891709n,
                    15448476048961421250495083913939888960507019236416367220733727182584406690173n,
                ],
                merkle_root:
                    14601560722057094868688356792980691747364698985297274009953072337353386968520n,
                depth: 30n,
                mt_index: 0n,
                siblings: [
                    0n,
                    15621590199821056450610068202457788725601603091791048810523422053872049975191n,
                    15180302612178352054084191513289999058431498575847349863917170755410077436260n,
                    20846426933296943402289409165716903143674406371782261099735847433924593192150n,
                    19570709311100149041770094415303300085749902031216638721752284824736726831172n,
                    11737142173000203701607979434185548337265641794352013537668027209469132654026n,
                    11865865012735342650993929214218361747705569437250152833912362711743119784159n,
                    1493463551715988755902230605042557878234810673525086316376178495918903796315n,
                    18746103596419850001763894956142528089435746267438407061601783590659355049966n,
                    21234194473503024590374857258930930634542887619436018385581872843343250130100n,
                    14681119568252857310414189897145410009875739166689283501408363922419813627484n,
                    13243470632183094581890559006623686685113540193867211988709619438324105679244n,
                    19463898140191333844443019106944343282402694318119383727674782613189581590092n,
                    10565902370220049529800497209344287504121041033501189980624875736992201671117n,
                    5560307625408070902174028041423028597194394554482880015024167821933869023078n,
                    20576730574720116265513866548855226316241518026808984067485384181494744706390n,
                    11166760821615661136366651998133963805984915741187325490784169611245269155689n,
                    13692603500396323648417392244466291089928913430742736835590182936663435788822n,
                    11129674755567463025028188404867541558752927519269975708924528737249823830641n,
                    6673535049007525806710184801639542254440636510496168661971704157154828514023n,
                    7958154589163466663626421142270206662020519181323839780192984613274682930816n,
                    3739156991379607404516753076057250171966250101655747790592556040569841550790n,
                    1334107297020502384420211493664486465203492095766400031330900935069700302301n,
                    20357028769054354174264046872903423695314313082869184437966002491602414517674n,
                    19392290367394672558538719012722289280213395590510602524366987685302929990731n,
                    7360502715619830055199267117332475946442427205382059394111067387016428818088n,
                    9629177338475347225553791169746168712988898028547587350296027054067573957412n,
                    21877160135037839571797468541807904053886800340144060811298025652177410263004n,
                    7105691694342706282901391345307729036900705570482804586768449537652208350743n,
                    15888057581779748293164452094398990053773731478520540058125130669204703869637n,
                ],
                beta: 1219447978145766874721695300216900264892278162307712369438981445355514609028n,
                rp_id: 148500211659041461394599242357030289810n,
                action: 15574411524701554947159716967598594376617389345302089033983599196736786897550n,
                nonce: 21697474931205116140076044014718540540776067939642973683638014972634574223599n,
            },
            true,
        );
        await circuit.assertOut(witness, {
            q: [
                9674018812144873985515234638873635008708834681175738612597888298086191498827n,
                18818965079786157878748649151755578492493325229415754584538271947197071123195n,
            ],
        });
        await circuit.checkConstraints(witness);
    });
});
